{% extends 'default.html'%}

{% block loginUsuario %}
<ul class="nav pull-right">
	<li class="dropdown">
		<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-user icon-white"></i> Login<b class="caret"></b></a>
			<ul class="dropdown-menu login-form">
				<li>
					<form method="post" action="" id="formLogin" name="formLogin">
						<fieldset id="datosAcceso">
							<label class="control-label usuario" for="usuario-cuit">Usuario</label>
							<span></span>
							<input type="text" id="usuario-cuit" name="usuario-cuit" required placeholder="C.U.I.T. sin guiones" class="{required:true, number:true, rangelength: [11,11]}"/>
							<label class="control-label usuario" for="usuario-clave">Contrase&ntilde;a</label>
							<span></span>
							<input type="password" id="usuario-clave" name="usuario-clave" required class="{required:true, maxlength:10}"/>
						</fieldset>
						<fieldset id="animacionAjax" style="text-align:center;">
						<img alt="" src="img/loader.gif" id="ajaxGif" class="hide"/>
						<div class="alert alert-error font-small hide" id="loginError"><strong>Usuario o Clave Incorrectos</strong></div>
						</fieldset>
						<fieldset id="botonera">
						<button class="btn btn-small btn-info" type="submit" id="botonLogin">Ingresar</button>
						</fieldset>
						<div class="divider"></div>
						<a href="" class="btn btn-link" id="altaEmpresa">Registrase Como Nuevo Usuario</a><br/>
						<div class="divider"></div>
						<a href="" class="btn btn-link" id="accesoClave">&iquest;Olvido su contrase&ntilde;a?</a><br/>
					</form>
				</li>
			</ul>
	</li>
</ul>
{% endblock %}

{% block ventanaClave %}
<div id="recuperaClave" title="Recuperaci&oacute;n de contrase&ntilde;a" class="hide">
	<p>Para recuperar la contrase&ntilde;a son necesarios el CUIT y el correo electr&oacute;nico que ingreso al registrarse como nuevo usuario.</p>
	<form id="formClave" name="formClave">
		<fieldset id="datosClave">
			<label for="clave_cuit">Usuario</label>
			<span></span>
			<input type="text" id="clave_cuit" name="clave_cuit" required placeholder="C.U.I.T. sin guiones" class="{required:true, number:true, rangelength: [11,11]}  span2"/>
			<label for="clave_correo">Correo Electr&oacute;nico </label>
			<span></span>
			<input type="text" id="clave_correo" name="clave_correo" required class="{required:true,email:true, maxlength:60} span3"/>
		</fieldset>
		<fieldset id="animacionAjaxClave" style="text-align:center;">
			<img alt="" src="img/loader.gif" id="ajaxGifClave" class="hide">
			<div class="alert alert-error font-small hide" id="claveError"><strong><span id="msgClaveError">Usuario o Correo Electr&oacute;nico incorrectos, intente de nuevo por favor.</span></strong></div>
			<div class="alert alert-success font-small hide" id="claveExito"><strong><span id="msgClaveExito">La consulta se ha realizado exitosamente. En instantes recibira su contrase&ntilde;a por correo electr&oacute;nico.</span></strong></div>
		</fieldset>
		<fieldset id="botonera" class="small-padding" style="text-align:center;">
			<button class="btn btn-small btn-primary" type="submit" id="botonClave">Enviar</button>
		</fieldset>
	</form>
</div>
{% endblock %}

{% block ventanaEmpresa %}
<div id="registroEmpresa" title="Registro de Empresa Nueva" class="hide">
	<form id="formEmpresa" name="formEmpresa">
		<fieldset id="datosEmpresa">
			<label for="cuit">C.U.I.T.</label>
			<span></span>
			<input type="text" id="cuit" name="cuit" required placeholder="C.U.I.T. sin guiones" class="{required:true, number:true, rangelength: [11,11]}  span2"/>
			<label for="nombre">Raz&oacute;n Social </label>
			<span></span>
			<input type="text" id="nombre" name="nombre" required class="{required:true, maxlength: 100, minlength: 4} span6"/>
			<label for="domicilio">Domicilio</label>
			<span></span>
			<input type="text" id="domicilio" name="domicilio" required class="{required:true, maxlength: 50, minlength: 4} span3"/>
			<label for="localidad">Localidad</label>
			<span></span>
			<input type="text" id="localidad" name="localidad" required onchange="cleanProvincia()" class="{required:true, maxlength: 50, minlength: 4} span3"/>
			<label for="provincia">Provincia</label>
			<span></span>
			<select id="provincia" name="provincia" class="input-xlarge {required:true}">	
				<option title="Seleccione un valor" value="">Seleccione un valor</option>
			</select>
			<label for="codpostal">C&oacute;digo Postal</label>
			<span></span>
			<input type="text" id="codpostal" name="codpostal" required class="{required:true, maxlength: 8, minlength: 4}"/>
			<label for="telefono">Tel&eacute;fono</label>
			<span></span>
			<input type="text" id="telefono" name="telefono" required class="{required:true, maxlength: 14, minlength: 6}"/>
			<label for="email">Correo Electr&oacute;nico</label>
			<span></span>
			<input type="email" id="email" name="email" required class="{required:true, maxlength: 60} span3"/>
			<label for="actividad">Actividad</label>
			<span></span>
			<input type="text" id="actividad" name="actividad" required class="{required:true, maxlength: 60} span3"/>
			<label for="rama">Rama</label>
			<span></span>
			<select id="rama" name="rama" class="input-xlarge {required:true}">	
				<option title="Seleccione un valor" value="">Seleccione un valor</option>
			</select>
			<label for="inicio">Inicio de Actividad</label>
			<span></span>
			<input type="text" id="inicio" name="inicio" placeholder="(DD/MM/AAAA)"/>
			<label for="clave">Contrase&ntilde;a</label>
			<span></span>
			<input type="text" id="clave" name="clave" required class="{required:true, maxlength: 10, minlength: 4} span2"/>
		</fieldset>
		<fieldset id="animacionAjaxEmpresa" style="text-align:center;">
			<img alt="" src="img/loader.gif" id="ajaxGifEmpresa" class="hide">
			<div class="alert alert-error font-small hide" id="EmpresaError"><strong><span id="mensajeError">Usuario o Correo Electr&oacute;nico Incorrectos, intente de nuevo por favor.</span></strong></div>
		</fieldset>
		<fieldset id="botonera" class="small-padding" style="text-align:center;">
			<button class="btn btn-small btn-primary" type="submit" id="botonEmpresa">Registrar</button>
		</fieldset>
	</form>
</div>
{% endblock %}

{% block cssPropios %}
<link rel="stylesheet" href="css/smoothness/jquery-ui-1.9.2.custom.min.css">
{% endblock %}

{% block javaScripts %}
	<script type="text/javascript" src="lib/js/jquery-validation-1.10.0/jquery.metadata.js"></script>
	<script type="text/javascript" src="lib/js/jquery-validation-1.10.0/jquery.validate.min.js"></script>
	<script type="text/javascript" src="lib/js/jquery-validation-1.10.0/localization/messages_es.js"></script>
	<script type="text/javascript" src="lib/js/jquery/jquery-ui-1.9.2.custom.min.js" ></script>
	<script type="text/javascript">
		$(function(){
			//Valido el formulario de Login
			$('#formLogin').validate({
				submitHandler: function(){
					var strForm = $('#formLogin').serialize();
					// ajax para ejecutar el login de usuario
					$.ajax({
						beforeSend: function(){
							// Verifico si el mensaje de error esta visible
			                if($('#loginError').is(':visible')){
			                   $('#loginError').addClass('hide');
            			    }
							$('#ajaxGif').removeClass('hide');
						},
						cache: false,
						type: "POST",
						dataType: "json",
						url:"respuestasApp.php",
						data:strForm + "&accion=login&id=" + Math.random(),
						success: function(response){
							//Controlo errores
							if(response.respuesta == true) {
				                window.location.href='index.php';
							} else {
								$('#loginError').removeClass('hide');
							}
							$('#ajaxGif').addClass('hide');
						},
						error: function(){
							alert("Error del Sistema, intentelo mas tarde.");
							$('#ajaxGif').addClass('hide');
						}
					});
					return false;
				},
				errorPlacement: function(error, element){
					error.appendTo(element.prev("span").append());
				}
			});

			// Ventana modal para recuperacion de contraseña
			$('#recuperaClave').dialog({
				autoOpen:false,
				modal:true,
				width:350,
				minHeight: 'auto',
				close:function(){
					$('#clave_cuit').val('');
					$('#clave_correo').val('');
					//if($('#claveError').is(':visible')) {
					//	$('#claveError').addClass('hide');
					//}
					//if($('#claveExito').is(':visible')) {
					//	$('#claveExito').addClass('hide');
					//}
				}
			});

			// Ventana modal para registro de nueva empresa
			$('#registroEmpresa').dialog({
				autoOpen:false,
				modal:true,
				width:'auto',
				minHeight: 'auto',
				close:function(){
				}
			});

			// Activo la ventana con el formulario de recuperacion de contraseña
			$('body').on('click','#accesoClave',function(elemento) {
				elemento.preventDefault();
				$('#recuperaClave').dialog('open');
			});

			// Activo la ventana con el formulario de registro de nueva empresa
			$('body').on('click','#altaEmpresa',function(elemento) {
				elemento.preventDefault();
				$('#registroEmpresa').dialog('open');
			});

			//Valido el formulario de recuperacion de contraseña
			$('#formClave').validate({
				submitHandler: function() {
					var formClave = $('#formClave').serialize();
					//alert(formClave);
					// ajax para ejecutar la recuperación de contraseña
					$.ajax({
						beforeSend: function(){
							// Verificamos si hay mensaje de error visible
							if($('#claveError').is(':visible')) {
								$('#claveError').addClass('hide');
							}
							if($('#claveExito').is(':visible')) {
								$('#claveExito').addClass('hide');
							}
							$('#ajaxGifClave').removeClass('hide');
						},
						cache: false,
						type: "POST",
						dataType: "json",
						url:"respuestasApp.php",
						data:formClave + "&accion=recuperaClave&id=" + Math.random(),
						success: function(response) {
							//Controlo errores
							if(response.respuesta == true) {
								//alert(response.mensaje);
								$('#claveExito').removeClass('hide');
								$('#botonClave').addClass('hide');
								//$('#recuperaClave').dialog('close');
        			        } else {
								//alert(response.mensaje);
								$('#claveError').removeClass('hide');
							}
							$('#ajaxGifClave').addClass('hide');
						},
						error:function() {
							alert('Error del Sistema, intentelo mas tarde.');
							$('#ajaxGifClave').addClass('hide');
						}
					});
					return false;
				},
				errorPlacement: function(error, element){
					error.appendTo(element.prev("span").append());
				}
			});

			//Valido el formulario de registro de nueva empresa
			$('#formEmpresa').validate({
				submitHandler: function(){
					var formEmpresa = $('#formEmpresa').serialize();
					alert(formEmpresa);
					return false;
				},
				errorPlacement: function(error, element){
					error.appendTo(element.prev("span").append());
				}
			});
		});
	</script>
{% endblock %}